
{% extends "base.html" %}

{% block content %}
<div class="login-page">
    <div class="arabic-pattern-bg"></div>
    <div class="login-container slide-in">
        <div class="login-image">
            <img src="{{ url_for('static', filename='images/login-bg.jpg') }}" alt="منصة الفؤاد التعليمية" class="zoom-on-hover">
        </div>
        <div class="login-form">
            <h2><i class="fas fa-graduation-cap"></i> منصة <span style="color: var(--primary-blue);">الفؤاد</span> التعليمية</h2>
            <p class="login-subtitle">الأستاذ محمد فواد - اللغة العربية</p>
            
            <!-- نموذج تسجيل الدخول -->
            <form method="POST" action="{{ url_for('login') }}" id="loginForm">
                <div class="form-group">
                    <label for="phone">رقم الهاتف</label>
                    <div class="password-input-container">
                        <input type="tel" id="phone" name="phone" placeholder="أدخل رقم هاتفك (11-12 رقم)" 
                               pattern="[0-9]{11,12}" title="يجب أن يكون رقم الهاتف بين 11 و 12 رقم" required>
                    </div>
                    <div class="input-error" id="phoneError"></div>
                </div>
                
                <div class="form-group">
                    <label for="password">كلمة المرور</label>
                    <div class="password-input-container">
                        <input type="password" id="password" name="password" placeholder="أدخل كلمة المرور" 
                               minlength="8" required>
                        <button type="button" class="password-toggle" onclick="togglePassword('password')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <div class="input-error" id="passwordError"></div>
                </div>
                
                <div class="form-options">
                    <div class="remember-me">
                        <input type="checkbox" id="rememberMe" name="remember_me">
                        <label for="rememberMe">تذكر بيانات الدخول</label>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary">
                    تسجيل الدخول
                </button>
            </form>
            
            <button class="btn btn-secondary" onclick="showRegisterForm()">
                إنشاء حساب جديد
            </button>
            
            <!-- نموذج إنشاء حساب جديد -->
            <div id="registerForm" class="register-form" style="display: none;">
                <h3>إنشاء حساب جديد</h3>
                <form method="POST" action="{{ url_for('register') }}" id="registerFormElement">
                    <!-- الاسم الأول -->
                    <div class="form-group">
                        <label for="firstName">الاسم الأول</label>
                        <input type="text" id="firstName" name="first_name" placeholder="الاسم الأول" required>
                        <div class="input-error" id="firstNameError"></div>
                    </div>
                    
                    <!-- اسم الأب -->
                    <div class="form-group">
                        <label for="fatherName">الاسم الثاني</label>
                        <input type="text" id="fatherName" name="father_name" placeholder="الاسم الثاني" required>
                        <div class="input-error" id="fatherNameError"></div>
                    </div>
                    
                    <!-- اسم الجد -->
                    <div class="form-group">
                        <label for="grandfatherName">الاسم الثالث</label>
                        <input type="text" id="grandfatherName" name="grandfather_name" placeholder="الاسم الثالث" required>
                        <div class="input-error" id="grandfatherNameError"></div>
                    </div>
                    
                    <!-- الاسم الكامل (يتم تعبئته تلقائياً) -->
                    <div class="form-group">
                        <label for="fullName">الاسم الكامل</label>
                        <input type="text" id="fullName" name="name" placeholder="سيتم تعبئته تلقائياً" readonly>
                    </div>
                    
                    <!-- رقم هاتف الطالب -->
                    <div class="form-group">
                        <label for="regPhone">رقم هاتف الطالب</label>
                        <input type="tel" id="regPhone" name="phone" placeholder="أدخل رقم هاتف الطالب (11-12 رقم)" 
                               pattern="[0-9]{11,12}" title="يجب أن يكون رقم الهاتف بين 11 و 12 رقم" required>
                        <div class="input-error" id="regPhoneError"></div>
                    </div>
                    
                    <!-- رقم هاتف ولي الأمر -->
                    <div class="form-group">
                        <label for="parent_phone">رقم هاتف ولي الأمر</label>
                        <input type="tel" id="parent_phone" name="parent_phone" placeholder="أدخل رقم هاتف ولي الأمر (11-12 رقم)" 
                               pattern="[0-9]{11,12}" title="يجب أن يكون رقم الهاتف بين 11 و 12 رقم" required>
                        <div class="input-error" id="parentPhoneError"></div>
                    </div>
                    
                    <!-- السنة الدراسية -->
                    <div class="form-group">
                        <label for="grade">السنة الدراسية</label>
                        <select id="grade" name="grade" required>
                            <option value="">اختر السنة الدراسية</option>
                            <option value="أولى ثانوي">أولى ثانوي</option>
                            <option value="ثانية ثانوي">ثانية ثانوي</option>
                            <option value="تالتة ثانوي">تالتة ثانوي</option>
                        </select>
                    </div>
                    
                    <!-- نظام التعليم -->
                    <div class="form-group">
                        <label for="education_type">نظام التعليم</label>
                        <select id="education_type" name="education_type" required>
                            <option value="">اختر نظام التعليم</option>
                            <option value="سنتر">سنتر</option>
                            <option value="أونلاين">أونلاين</option>
                        </select>
                    </div>
                    
                    <!-- كلمة المرور -->
                    <div class="form-group">
                        <label for="regPassword">كلمة المرور</label>
                        <div class="password-input-container">
                            <input type="password" id="regPassword" name="password" placeholder="كلمة المرور (8 أحرف على الأقل)" 
                                   minlength="8" required>
                            <button type="button" class="password-toggle" onclick="togglePassword('regPassword')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <div class="password-strength" id="passwordStrength">
                            <div class="strength-bar">
                                <div class="strength-fill" id="strengthFill"></div>
                            </div>
                            <span class="strength-text" id="strengthText">قوة كلمة المرور</span>
                        </div>
                    </div>
                    
                    <!-- تأكيد كلمة المرور -->
                    <div class="form-group">
                        <label for="confirm_password">تأكيد كلمة المرور</label>
                        <div class="password-input-container">
                            <input type="password" id="confirm_password" name="confirm_password" 
                                   placeholder="أعد إدخال كلمة المرور" minlength="8" required>
                            <button type="button" class="password-toggle" onclick="togglePassword('confirm_password')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <div class="input-error" id="confirmPasswordError"></div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        إنشاء الحساب
                    </button>
                </form>
                
                <button class="btn btn-secondary" onclick="hideRegisterForm()" style="margin-top: 10px;">
                    العودة لتسجيل الدخول
                </button>
            </div>
        </div>
    </div>
</div>

<!-- رسائل التنبيه -->
<div id="alertContainer" class="alert-container"></div>
{% endblock %}

{% block styles %}
<style>
/* تحسينات للجوال */
@media (max-width: 768px) {
    .login-container {
        flex-direction: column;
        margin: 10px;
    }
    
    .login-image {
        display: none;
    }
    
    .login-form {
        padding: 20px;
    }
}

.form-options {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.remember-me {
    display: flex;
    align-items: center;
    gap: 8px;
}

.remember-me input[type="checkbox"] {
    width: 16px;
    height: 16px;
}

.alert-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1000;
}

.alert {
    padding: 12px 20px;
    border-radius: 8px;
    margin-bottom: 10px;
    animation: slideInRight 0.3s ease;
}

.alert-success {
    background: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

.alert-error {
    background: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

@keyframes slideInRight {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}
</style>
{% endblock %}

{% block scripts %}
<script>
// دالة إظهار/إخفاء كلمة المرور
function togglePassword(fieldId) {
    const field = document.getElementById(fieldId);
    const icon = field.parentElement.querySelector('.password-toggle i');
    
    if (field.type === 'password') {
        field.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
    } else {
        field.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
    }
}

// دالة حساب قوة كلمة المرور
function checkPasswordStrength(password) {
    let strength = 0;
    const strengthFill = document.getElementById('strengthFill');
    const strengthText = document.getElementById('strengthText');
    const passwordStrength = document.getElementById('passwordStrength');
    
    // إظهار شريط القوة
    passwordStrength.style.display = 'block';
    
    if (password.length >= 8) strength++;
    if (password.match(/[a-z]/)) strength++;
    if (password.match(/[A-Z]/)) strength++;
    if (password.match(/[0-9]/)) strength++;
    if (password.match(/[^a-zA-Z0-9]/)) strength++;
    
    // تحديث واجهة قوة كلمة المرور
    strengthFill.className = 'strength-fill';
    switch(strength) {
        case 0:
        case 1:
            strengthFill.classList.add('strength-weak');
            strengthText.textContent = 'ضعيفة';
            strengthText.style.color = '#e74c3c';
            break;
        case 2:
        case 3:
            strengthFill.classList.add('strength-medium');
            strengthText.textContent = 'متوسطة';
            strengthText.style.color = '#f39c12';
            break;
        case 4:
        case 5:
            strengthFill.classList.add('strength-strong');
            strengthText.textContent = 'قوية';
            strengthText.style.color = '#27ae60';
            break;
    }
}

// دالة التحقق من تطابق كلمة المرور
function validatePasswordMatch() {
    const password = document.getElementById('regPassword').value;
    const confirmPassword = document.getElementById('confirm_password').value;
    const errorElement = document.getElementById('confirmPasswordError');
    
    if (confirmPassword && password !== confirmPassword) {
        errorElement.textContent = 'كلمة المرور غير متطابقة';
        errorElement.style.display = 'block';
        return false;
    } else {
        errorElement.style.display = 'none';
        return true;
    }
}

// دالة إنشاء الاسم الكامل تلقائياً
function updateFullName() {
    const firstName = document.getElementById('firstName').value;
    const fatherName = document.getElementById('fatherName').value;
    const grandfatherName = document.getElementById('grandfatherName').value;
    
    const fullName = `${firstName} ${fatherName} ${grandfatherName}`.trim();
    document.getElementById('fullName').value = fullName;
}

// التحقق من رقم الهاتف
function validatePhone(phone) {
    const phoneRegex = /^[0-9]{11,12}$/;
    return phoneRegex.test(phone);
}

// إظهار رسالة تنبيه
function showAlert(message, type = 'success') {
    const alertContainer = document.getElementById('alertContainer');
    const alert = document.createElement('div');
    alert.className = `alert alert-${type}`;
    alert.textContent = message;
    
    alertContainer.appendChild(alert);
    
    setTimeout(() => {
        alert.remove();
    }, 5000);
}

// التحقق من صحة نموذج التسجيل
function validateRegisterForm() {
    const phone = document.getElementById('regPhone').value;
    const parentPhone = document.getElementById('parent_phone').value;
    const password = document.getElementById('regPassword').value;
    const confirmPassword = document.getElementById('confirm_password').value;
    
    let isValid = true;
    
    // التحقق من أرقام الهواتف
    if (!validatePhone(phone)) {
        document.getElementById('regPhoneError').textContent = 'رقم الهاتف يجب أن يكون بين 11 و 12 رقم';
        document.getElementById('regPhoneError').style.display = 'block';
        isValid = false;
    } else {
        document.getElementById('regPhoneError').style.display = 'none';
    }
    
    if (!validatePhone(parentPhone)) {
        document.getElementById('parentPhoneError').textContent = 'رقم الهاتف يجب أن يكون بين 11 و 12 رقم';
        document.getElementById('parentPhoneError').style.display = 'block';
        isValid = false;
    } else {
        document.getElementById('parentPhoneError').style.display = 'none';
    }
    
    // التحقق من كلمة المرور
    if (password.length < 8) {
        showAlert('كلمة المرور يجب أن تكون 8 أحرف على الأقل', 'error');
        isValid = false;
    }
    
    if (password !== confirmPassword) {
        document.getElementById('confirmPasswordError').textContent = 'كلمة المرور غير متطابقة';
        document.getElementById('confirmPasswordError').style.display = 'block';
        isValid = false;
    } else {
        document.getElementById('confirmPasswordError').style.display = 'none';
    }
    
    return isValid;
}

// أحداث التحقق
document.addEventListener('DOMContentLoaded', function() {
    // تحديث الاسم الكامل عند تغيير الأسماء
    document.getElementById('firstName').addEventListener('input', updateFullName);
    document.getElementById('fatherName').addEventListener('input', updateFullName);
    document.getElementById('grandfatherName').addEventListener('input', updateFullName);
    
    // التحقق من قوة كلمة المرور
    document.getElementById('regPassword').addEventListener('input', function(e) {
        checkPasswordStrength(e.target.value);
    });
    
    // التحقق من تطابق كلمة المرور
    document.getElementById('confirm_password').addEventListener('input', validatePasswordMatch);
    
    // التحقق من رقم الهاتف
    document.getElementById('regPhone').addEventListener('blur', function(e) {
        const errorElement = document.getElementById('regPhoneError');
        if (!validatePhone(e.target.value)) {
            errorElement.textContent = 'رقم الهاتف يجب أن يكون بين 11 و 12 رقم';
            errorElement.style.display = 'block';
        } else {
            errorElement.style.display = 'none';
        }
    });
    
    // التحقق من رقم ولي الأمر
    document.getElementById('parent_phone').addEventListener('blur', function(e) {
        const errorElement = document.getElementById('parentPhoneError');
        if (!validatePhone(e.target.value)) {
            errorElement.textContent = 'رقم الهاتف يجب أن يكون بين 11 و 12 رقم';
            errorElement.style.display = 'block';
        } else {
            errorElement.style.display = 'none';
        }
    });
    
    // التحقق قبل إرسال نموذج التسجيل
    document.getElementById('registerFormElement').addEventListener('submit', function(e) {
        if (!validateRegisterForm()) {
            e.preventDefault();
        }
    });
});

// دوال إظهار/إخفاء نموذج التسجيل
function showRegisterForm() {
    document.getElementById('registerForm').style.display = 'block';
    document.querySelector('.login-form form').style.display = 'none';
    document.querySelector('.btn-secondary').style.display = 'none';
}

function hideRegisterForm() {
    document.getElementById('registerForm').style.display = 'none';
    document.querySelector('.login-form form').style.display = 'block';
    document.querySelector('.btn-secondary').style.display = 'block';
}
</script>
{% endblock %}
[file content end]